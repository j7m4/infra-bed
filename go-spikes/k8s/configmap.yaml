apiVersion: v1
kind: ConfigMap
metadata:
  name: go-spikes-config
  namespace: default
data:
  config.yaml: |
    server:
      port: 8888
      readTimeout: 30s
      writeTimeout: 30s
      idleTimeout: 120s
    
    kafka:
      brokers:
        - kafka-cluster-kafka-bootstrap.streaming:9092
      topic: test-topic
      consumerGroup: go-spikes-consumer
      producer:
        clientId: go-spikes-producer
        batchSize: 100
        batchTimeout: 1s
        compressionType: snappy
        maxRetries: 3
        acks: all
        logBatchSize: 10000
      consumer:
        clientId: go-spikes-consumer
        isolationLevel: read_committed
        heartbeatInterval: 3s
        maxPollRecords: 500
        autoOffsetReset: earliest
        sessionTimeout: 10s
        maxPollInterval: 5m
        autoCommitEnabled: true
        autoCommitInterval: 5s
        logBatchSize: 10000
    
    database:
      mysql:
        enabled: true
        host: mycluster-router.default
        port: 6446
        database: test_db
        user: root
        maxConnections: 25
        maxIdleConns: 5
        connMaxLifetime: 5m
      postgres:
        enabled: true
        host: postgres-cluster-rw.default
        port: 5432
        database: myapp
        user: app
        sslMode: disable
        maxConnections: 25
        maxIdleConns: 5
        connMaxLifetime: 5m
    
    features:
      enableProfiling: true
      enableTracing: true
      enableMetrics: true
      logLevel: info
      experimental:
        asyncProcessing: false
        cacheWarmup: false
        advancedMetrics: true
    
    metrics:
      scrapeInterval: 10s
      histogramBuckets:
        - 0.001
        - 0.01
        - 0.1
        - 0.5
        - 1
        - 2.5
        - 5
        - 10
      labels:
        environment: development
        team: infrastructure
        version: v1.0.0
        
    tests:
      entityRepo:
        plugins:
          consumer:
            jobName: "consumer-kafka-1"
            # 0 value means run indefinitely
            runDuration: 15m
            # 0 value means no initial delay
            initialDelayDuration: 0
            # 0 value means no pause between intervals
            intervalDuration: 0
            logBatchSize: 10000
          producer:
            jobName: "producer-kafka-1"
            entityCount: 10
            attributeCount: 5
            # 0 value means run indefinitely
            runDuration: 15m
            # 0 value means no initial delay
            initialDelayDuration: 0
            # 0 value means no pause between intervals
            intervalDuration: 1ms
            logBatchSize: 10000
        kafkaOverrides:
          brokers:
          - persistent-cluster-kafka-bootstrap.streaming:9092
          topic: entity-repo
          producer:
            clientId: entity-repo-producer
            compressionType: snappy
            maxRetries: 3
            logBatchSize: 10000
          consumer:
            clientId: entity-repo-consumer
            isolationLevel: read_committed
            autoOffsetReset: earliest
            autoCommitEnabled: true
            autoCommitInterval: 15s
            consumerGroup: entity-repo-consumer
            logBatchSize: 10000